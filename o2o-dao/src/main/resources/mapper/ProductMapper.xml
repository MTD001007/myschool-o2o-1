<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.iweb.o2o.mapper.ProductMapper" >
  <resultMap id="BaseResultMap" type="com.iweb.o2o.entity.Product" >
    <id column="product_id" property="productId" jdbcType="INTEGER" />
    <result column="product_name" property="productName" jdbcType="VARCHAR" />
    <result column="product_desc" property="productDesc" jdbcType="VARCHAR" />
    <result column="img_addr" property="imgAddr" jdbcType="VARCHAR" />
    <result column="normal_price" property="normalPrice" jdbcType="VARCHAR" />
    <result column="promotion_price" property="promotionPrice" jdbcType="VARCHAR" />
    <result column="priority" property="priority" jdbcType="INTEGER" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="last_edit_time" property="lastEditTime" jdbcType="TIMESTAMP" />
    <result column="enable_status" property="enableStatus" jdbcType="INTEGER" />
    <result column="point" property="point" jdbcType="INTEGER" />
    <!--<result column="product_category_id" property="productCategoryId" jdbcType="INTEGER" />-->
    <!--<result column="shop_id" property="shopId" jdbcType="INTEGER" />-->
    <association property="productCategory" column="product_category_id" select="selectProductCategoryById"></association>
    <association property="shop" column="shop_id" select="selectShopById"></association>
  </resultMap>
  <select id="selectProductCategoryById" resultType="com.iweb.o2o.entity.ProductCategory">
    select * from tb_product_category
    where product_category_id = #{productCategoryId}
  </select>
  <select id="selectShopById" resultType="shop">
    select * from tb_shop
    where shop_id = #{shopId}
  </select>

  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from tb_product
    where product_id = #{productId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.iweb.o2o.entity.Product" >
    insert into tb_product (product_id, product_name, product_desc, 
      img_addr, normal_price, promotion_price, 
      priority, create_time, last_edit_time, 
      enable_status, point, product_category_id, 
      shop_id)
    values (#{productId,jdbcType=INTEGER}, #{productName,jdbcType=VARCHAR}, #{productDesc,jdbcType=VARCHAR}, 
      #{imgAddr,jdbcType=VARCHAR}, #{normalPrice,jdbcType=VARCHAR}, #{promotionPrice,jdbcType=VARCHAR}, 
      #{priority,jdbcType=INTEGER}, #{createTime,jdbcType=TIMESTAMP}, #{lastEditTime,jdbcType=TIMESTAMP}, 
      #{enableStatus,jdbcType=INTEGER}, #{point,jdbcType=INTEGER}, #{productCategoryId,jdbcType=INTEGER}, 
      #{shopId,jdbcType=INTEGER})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.iweb.o2o.entity.Product" >
    update tb_product
    set product_name = #{productName,jdbcType=VARCHAR},
      product_desc = #{productDesc,jdbcType=VARCHAR},
      img_addr = #{imgAddr,jdbcType=VARCHAR},
      normal_price = #{normalPrice,jdbcType=VARCHAR},
      promotion_price = #{promotionPrice,jdbcType=VARCHAR},
      priority = #{priority,jdbcType=INTEGER},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      last_edit_time = #{lastEditTime,jdbcType=TIMESTAMP},
      enable_status = #{enableStatus,jdbcType=INTEGER},
      point = #{point,jdbcType=INTEGER},
      product_category_id = #{productCategoryId,jdbcType=INTEGER},
      shop_id = #{shopId,jdbcType=INTEGER}
    where product_id = #{productId,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    select product_id, product_name, product_desc, img_addr, normal_price, promotion_price, 
    priority, create_time, last_edit_time, enable_status, point, product_category_id, 
    shop_id
    from tb_product
    where product_id = #{productId,jdbcType=INTEGER}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    select product_id, product_name, product_desc, img_addr, normal_price, promotion_price, 
    priority, create_time, last_edit_time, enable_status, point, product_category_id, 
    shop_id
    from tb_product
  </select>
  <select id="selectTop5" resultMap="BaseResultMap">
  SELECT product_id,product_name,normal_price
  FROM tb_product
  WHERE product_category_id=#{productCategoryId} AND shop_id=#{shopId}
  ORDER BY normal_price+0 desc
  LIMIT 0,5
  </select>
  <select id="selectProductByShopId" resultMap="BaseResultMap">
    SELECT *
  FROM tb_product
  WHERE shop_id=#{shopId}
  ORDER BY priority DESC
  </select>
  <select id="getProducts" parameterType="product" resultType="product">
      SELECT * FROM tb_product
  </select>
  <resultMap id="BaseResultMap2" type="com.iweb.o2o.entity.Extra">
    <!--<result column="" property="dayForUse" jdbcType="" />-->
  </resultMap>
  <select id="selectCountInGivenTime" resultMap="BaseResultMap2">
  SELECT t.d as dayForUse,COUNT(*) as countNumber
      FROM
      (
      SELECT product_id,product_name,create_time,DATE_FORMAT(create_time,'%d') d
      FROM `tb_product`
      WHERE DATE_FORMAT(create_time,'%y')=17 AND shop_id=20
      ) t
      GROUP BY t.d
  </select>

</mapper>